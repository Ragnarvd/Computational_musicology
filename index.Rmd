---
title: "Musicology_Portfolio"
author: "Ragnar van Dort"
date: "2/22/2022"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    theme: 
      version: 4
      bootswatch: minty
    
---
```{r setup}
  library(tidyverse)
  library(plotly)
  library(spotifyr)
  library(compmus)
```

### Introduction

The main goal of this corpus is to compare playlists, to be specific, compare study playlists. A lot of people study, and a lot of people study while listening to music. All people are different and we also see this in their music taste; it's often said that classical music is great for studying and this is also backed by different studies but there also a lot of other kinds of music that students listen to: LoFi, techno etc.

In this corpus Iâ€™ll take different Spotify music playlists and try to compare them; what are the differences between the different playlists? Without their label is there a big difference?

I will work with four different playlists all created by spotiff: a pop study playlist, a classical music study playlist, a techno study playlist and a LoFi study playlist.

- Pop Study: https://open.spotify.com/playlist/37i9dQZF1DWSoyxGghlqv5 
- Classical Studying music: https://open.spotify.com/playlist/37i9dQZF1EIgLoMVUd9oTU 
- Electronic Focus: https://open.spotify.com/playlist/37i9dQZF1DX0wMD4IoQ5aJ Chill 
- Lofi Study Beats: https://open.spotify.com/playlist/37i9dQZF1DX8Uebhn9wzrS

My hypothesis for this research is that there will be a lot of similarities, probably a low bpm and not too energetic for example. But I hope to find some interesting differences that I can then investigate further and possibly explain.


### Valence Energy

```{r energy and valence}
pop <- get_playlist_audio_features("", "37i9dQZF1DWSoyxGghlqv5")
classic <- get_playlist_audio_features("", "37i9dQZF1EIgLoMVUd9oTU")
electronic <- get_playlist_audio_features("", "37i9dQZF1DX0wMD4IoQ5aJ")
lofi <- get_playlist_audio_features("", "37i9dQZF1DX8Uebhn9wzrS")

study <-
  pop %>%
  mutate(country = "Pop study") %>%
  bind_rows(classic %>% mutate(country = "Classical study")) %>%
  bind_rows(electronic %>% mutate(country = "Electronic study")) %>%
  bind_rows(lofi %>% mutate(country = "Lofi study"))%>%
mutate(
  country = fct_relevel(country, "Pop study, Classical study, Electronical study", "Lofi study")
)

february_dip <-
  study %>%
  ggplot(                          # Set up the plot.
    aes(
      x = valence,
      y = energy,
      size = track.popularity,
      colour = danceability,
      label = track.name           # Labels will be interactively visible.
    )
  ) +
  geom_point() +                   # Scatter plot.
  geom_rug(size = 0.1) +           # Add 'fringes' to show data distribution.
  facet_wrap(~country) +           # Separate charts per country.
  scale_x_continuous(              # Fine-tune the x axis.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),        # Use grid-lines for quadrants only.
    minor_breaks = NULL            # Remove 'minor' grid-lines.
  ) +
  scale_y_continuous(              # Fine-tune the y axis in the same way.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),
    minor_breaks = NULL
  ) +
  scale_colour_viridis_c(          # Use the cividis palette
    option = "E",                  # Qualitative set.
    alpha = 0.8,                   # Include some transparency
    guide = "none"
  ) +
  scale_size_continuous(           # Fine-tune the sizes of each point.
    guide = "none"                 # Remove the legend for size.
  ) +
  theme_light() +                  # Use a simpler theme.
  labs(                            # Make the titles nice.
    x = "Valence",
    y = "Energy"
  )

ggplotly(february_dip)
```
*** 

Test test test

### The Godfather finale [chroma and timbre features]

```{r godfather}
bzt <-
  get_tidy_audio_analysis("78Q2Em989i9lagCBf8XGyX") %>% 
  compmus_align(bars, segments) %>%
  select(bars) %>%
  unnest(bars) %>%
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "acentre", norm = "manhattan"
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  )
bind_rows(
  bzt %>% 
    compmus_self_similarity(pitches, "aitchison") %>% 
    mutate(d = d / max(d), type = "Chroma"),
  bzt %>% 
    compmus_self_similarity(timbre, "euclidean") %>% 
    mutate(d = d / max(d), type = "Timbre")
) %>%
  mutate() %>% 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(option = "E", guide = "none") +
  theme_classic() + 
  labs(x = "", y = "")
```

***

Chroma all over the place
Timbre a lot more similarities, you can clearly see the violin part (110-160 sec)
